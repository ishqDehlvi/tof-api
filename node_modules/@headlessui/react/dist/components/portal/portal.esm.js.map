{"version":3,"file":"portal.esm.js","sources":["../../../src/components/portal/portal.tsx"],"sourcesContent":["import React, {\n  Fragment,\n  createContext,\n  useContext,\n  useEffect,\n  useState,\n\n  // Types\n  ElementType,\n  MutableRefObject,\n} from 'react'\nimport { createPortal } from 'react-dom'\n\nimport { Props } from '../../types'\nimport { render } from '../../utils/render'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { usePortalRoot } from '../../internal/portal-force-root'\nimport { useServerHandoffComplete } from '../../hooks/use-server-handoff-complete'\n\nfunction usePortalTarget(): HTMLElement | null {\n  let forceInRoot = usePortalRoot()\n  let groupTarget = useContext(PortalGroupContext)\n  let [target, setTarget] = useState(() => {\n    // Group context is used, but still null\n    if (!forceInRoot && groupTarget !== null) return null\n\n    // No group context is used, let's create a default portal root\n    if (typeof window === 'undefined') return null\n    let existingRoot = document.getElementById('headlessui-portal-root')\n    if (existingRoot) return existingRoot\n\n    let root = document.createElement('div')\n    root.setAttribute('id', 'headlessui-portal-root')\n    return document.body.appendChild(root)\n  })\n\n  // Ensure the portal root is always in the DOM\n  useEffect(() => {\n    if (target === null) return\n\n    if (!document.body.contains(target)) {\n      document.body.appendChild(target)\n    }\n  }, [target])\n\n  useEffect(() => {\n    if (forceInRoot) return\n    if (groupTarget === null) return\n    setTarget(groupTarget.current)\n  }, [groupTarget, setTarget, forceInRoot])\n\n  return target\n}\n\n// ---\n\nlet DEFAULT_PORTAL_TAG = Fragment\ninterface PortalRenderPropArg {}\n\nexport function Portal<TTag extends ElementType = typeof DEFAULT_PORTAL_TAG>(\n  props: Props<TTag, PortalRenderPropArg>\n) {\n  let passthroughProps = props\n  let target = usePortalTarget()\n  let [element] = useState<HTMLDivElement | null>(() =>\n    typeof window === 'undefined' ? null : document.createElement('div')\n  )\n\n  let ready = useServerHandoffComplete()\n\n  useIsoMorphicEffect(() => {\n    if (!target) return\n    if (!element) return\n\n    target.appendChild(element)\n\n    return () => {\n      if (!target) return\n      if (!element) return\n\n      target.removeChild(element)\n\n      if (target.childNodes.length <= 0) {\n        target.parentElement?.removeChild(target)\n      }\n    }\n  }, [target, element])\n\n  if (!ready) return null\n\n  return !target || !element\n    ? null\n    : createPortal(\n        render({ props: passthroughProps, defaultTag: DEFAULT_PORTAL_TAG, name: 'Portal' }),\n        element\n      )\n}\n\n// ---\n\nlet DEFAULT_GROUP_TAG = Fragment\ninterface GroupRenderPropArg {}\n\nlet PortalGroupContext = createContext<MutableRefObject<HTMLElement | null> | null>(null)\n\nfunction Group<TTag extends ElementType = typeof DEFAULT_GROUP_TAG>(\n  props: Props<TTag, GroupRenderPropArg> & {\n    target: MutableRefObject<HTMLElement | null>\n  }\n) {\n  let { target, ...passthroughProps } = props\n\n  return (\n    <PortalGroupContext.Provider value={target}>\n      {render({\n        props: passthroughProps,\n        defaultTag: DEFAULT_GROUP_TAG,\n        name: 'Popover.Group',\n      })}\n    </PortalGroupContext.Provider>\n  )\n}\n\n// ---\n\nPortal.Group = Group\n"],"names":["usePortalTarget","forceInRoot","usePortalRoot","groupTarget","useContext","PortalGroupContext","useState","window","existingRoot","document","getElementById","root","createElement","setAttribute","body","appendChild","target","setTarget","useEffect","contains","current","DEFAULT_PORTAL_TAG","Fragment","Portal","props","passthroughProps","element","ready","useServerHandoffComplete","useIsoMorphicEffect","removeChild","childNodes","length","parentElement","createPortal","render","defaultTag","name","DEFAULT_GROUP_TAG","createContext","Group","React","Provider","value"],"mappings":"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"}