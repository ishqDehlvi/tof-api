{"version":3,"file":"tabs.esm.js","sources":["../../../src/components/tabs/tabs.tsx"],"sourcesContent":["import React, {\n  Fragment,\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useReducer,\n  useRef,\n  useEffect,\n\n  // Types\n  ElementType,\n  MutableRefObject,\n  KeyboardEvent as ReactKeyboardEvent,\n  Dispatch,\n  ContextType,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { render, Features, PropsForFeatures } from '../../utils/render'\nimport { useId } from '../../hooks/use-id'\nimport { match } from '../../utils/match'\nimport { Keys } from '../../components/keyboard'\nimport { focusIn, Focus } from '../../utils/focus-management'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\ninterface StateDefinition {\n  selectedIndex: number | null\n\n  orientation: 'horizontal' | 'vertical'\n  activation: 'auto' | 'manual'\n\n  tabs: MutableRefObject<HTMLElement | null>[]\n  panels: MutableRefObject<HTMLElement | null>[]\n}\n\nenum ActionTypes {\n  SetSelectedIndex,\n  SetOrientation,\n  SetActivation,\n\n  RegisterTab,\n  UnregisterTab,\n\n  RegisterPanel,\n  UnregisterPanel,\n\n  ForceRerender,\n}\n\ntype Actions =\n  | { type: ActionTypes.SetSelectedIndex; index: number }\n  | { type: ActionTypes.SetOrientation; orientation: StateDefinition['orientation'] }\n  | { type: ActionTypes.SetActivation; activation: StateDefinition['activation'] }\n  | { type: ActionTypes.RegisterTab; tab: MutableRefObject<HTMLElement | null> }\n  | { type: ActionTypes.UnregisterTab; tab: MutableRefObject<HTMLElement | null> }\n  | { type: ActionTypes.RegisterPanel; panel: MutableRefObject<HTMLElement | null> }\n  | { type: ActionTypes.UnregisterPanel; panel: MutableRefObject<HTMLElement | null> }\n  | { type: ActionTypes.ForceRerender }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.SetSelectedIndex](state, action) {\n    if (state.selectedIndex === action.index) return state\n    return { ...state, selectedIndex: action.index }\n  },\n  [ActionTypes.SetOrientation](state, action) {\n    if (state.orientation === action.orientation) return state\n    return { ...state, orientation: action.orientation }\n  },\n  [ActionTypes.SetActivation](state, action) {\n    if (state.activation === action.activation) return state\n    return { ...state, activation: action.activation }\n  },\n  [ActionTypes.RegisterTab](state, action) {\n    if (state.tabs.includes(action.tab)) return state\n    return { ...state, tabs: [...state.tabs, action.tab] }\n  },\n  [ActionTypes.UnregisterTab](state, action) {\n    return { ...state, tabs: state.tabs.filter(tab => tab !== action.tab) }\n  },\n  [ActionTypes.RegisterPanel](state, action) {\n    if (state.panels.includes(action.panel)) return state\n    return { ...state, panels: [...state.panels, action.panel] }\n  },\n  [ActionTypes.UnregisterPanel](state, action) {\n    return { ...state, panels: state.panels.filter(panel => panel !== action.panel) }\n  },\n  [ActionTypes.ForceRerender](state) {\n    return { ...state }\n  },\n}\n\nlet TabsContext = createContext<\n  [StateDefinition, { change(index: number): void; dispatch: Dispatch<Actions> }] | null\n>(null)\nTabsContext.displayName = 'TabsContext'\n\nfunction useTabsContext(component: string) {\n  let context = useContext(TabsContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <Tab.Group /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useTabsContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_TABS_TAG = Fragment\ninterface TabsRenderPropArg {\n  selectedIndex: number\n}\n\nfunction Tabs<TTag extends ElementType = typeof DEFAULT_TABS_TAG>(\n  props: Props<TTag, TabsRenderPropArg> & {\n    defaultIndex?: number\n    onChange?: (index: number) => void\n    selectedIndex?: number\n    vertical?: boolean\n    manual?: boolean\n  }\n) {\n  let {\n    defaultIndex = 0,\n    vertical = false,\n    manual = false,\n    onChange,\n    selectedIndex = null,\n    ...passThroughProps\n  } = props\n  const orientation = vertical ? 'vertical' : 'horizontal'\n  const activation = manual ? 'manual' : 'auto'\n\n  let [state, dispatch] = useReducer(stateReducer, {\n    selectedIndex: null,\n    tabs: [],\n    panels: [],\n    orientation,\n    activation,\n  } as StateDefinition)\n  let slot = useMemo(() => ({ selectedIndex: state.selectedIndex }), [state.selectedIndex])\n  let onChangeRef = useRef<(index: number) => void>(() => {})\n\n  useEffect(() => {\n    dispatch({ type: ActionTypes.SetOrientation, orientation })\n  }, [orientation])\n\n  useEffect(() => {\n    dispatch({ type: ActionTypes.SetActivation, activation })\n  }, [activation])\n\n  useEffect(() => {\n    if (typeof onChange === 'function') {\n      onChangeRef.current = onChange\n    }\n  }, [onChange])\n\n  useEffect(() => {\n    if (state.tabs.length <= 0) return\n    if (selectedIndex === null && state.selectedIndex !== null) return\n\n    let tabs = state.tabs.map(tab => tab.current).filter(Boolean) as HTMLElement[]\n    let focusableTabs = tabs.filter(tab => !tab.hasAttribute('disabled'))\n\n    let indexToSet = selectedIndex ?? defaultIndex\n\n    // Underflow\n    if (indexToSet < 0) {\n      dispatch({ type: ActionTypes.SetSelectedIndex, index: tabs.indexOf(focusableTabs[0]) })\n    }\n\n    // Overflow\n    else if (indexToSet > state.tabs.length) {\n      dispatch({\n        type: ActionTypes.SetSelectedIndex,\n        index: tabs.indexOf(focusableTabs[focusableTabs.length - 1]),\n      })\n    }\n\n    // Middle\n    else {\n      let before = tabs.slice(0, indexToSet)\n      let after = tabs.slice(indexToSet)\n\n      let next = [...after, ...before].find(tab => focusableTabs.includes(tab))\n      if (!next) return\n\n      dispatch({ type: ActionTypes.SetSelectedIndex, index: tabs.indexOf(next) })\n    }\n  }, [defaultIndex, selectedIndex, state.tabs, state.selectedIndex])\n\n  let lastChangedIndex = useRef(state.selectedIndex)\n  let providerBag = useMemo<ContextType<typeof TabsContext>>(\n    () => [\n      state,\n      {\n        dispatch,\n        change(index: number) {\n          if (lastChangedIndex.current !== index) onChangeRef.current(index)\n          lastChangedIndex.current = index\n\n          dispatch({ type: ActionTypes.SetSelectedIndex, index })\n        },\n      },\n    ],\n    [state, dispatch]\n  )\n\n  return (\n    <TabsContext.Provider value={providerBag}>\n      {render({\n        props: { ...passThroughProps },\n        slot,\n        defaultTag: DEFAULT_TABS_TAG,\n        name: 'Tabs',\n      })}\n    </TabsContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_LIST_TAG = 'div' as const\ninterface ListRenderPropArg {\n  selectedIndex: number\n}\ntype ListPropsWeControl = 'role' | 'aria-orientation'\n\nfunction List<TTag extends ElementType = typeof DEFAULT_LIST_TAG>(\n  props: Props<TTag, ListRenderPropArg, ListPropsWeControl> & {}\n) {\n  let [{ selectedIndex, orientation }] = useTabsContext([Tab.name, List.name].join('.'))\n\n  let slot = { selectedIndex }\n  let propsWeControl = {\n    role: 'tablist',\n    'aria-orientation': orientation,\n  }\n  let passThroughProps = props\n\n  return render({\n    props: { ...passThroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_LIST_TAG,\n    name: 'Tabs.List',\n  })\n}\n\n// ---\n\nlet DEFAULT_TAB_TAG = 'button' as const\ninterface TabRenderPropArg {\n  selected: boolean\n}\ntype TabPropsWeControl = 'id' | 'role' | 'type' | 'aria-controls' | 'aria-selected' | 'tabIndex'\n\nexport function Tab<TTag extends ElementType = typeof DEFAULT_TAB_TAG>(\n  props: Props<TTag, TabRenderPropArg, TabPropsWeControl>\n) {\n  let id = `headlessui-tabs-tab-${useId()}`\n\n  let [\n    { selectedIndex, tabs, panels, orientation, activation },\n    { dispatch, change },\n  ] = useTabsContext(Tab.name)\n\n  let internalTabRef = useRef<HTMLElement>(null)\n  let tabRef = useSyncRefs(internalTabRef, element => {\n    if (!element) return\n    dispatch({ type: ActionTypes.ForceRerender })\n  })\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterTab, tab: internalTabRef })\n    return () => dispatch({ type: ActionTypes.UnregisterTab, tab: internalTabRef })\n  }, [dispatch, internalTabRef])\n\n  let myIndex = tabs.indexOf(internalTabRef)\n  let selected = myIndex === selectedIndex\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLElement>) => {\n      let list = tabs.map(tab => tab.current).filter(Boolean) as HTMLElement[]\n\n      if (event.key === Keys.Space || event.key === Keys.Enter) {\n        event.preventDefault()\n        event.stopPropagation()\n\n        change(myIndex)\n        return\n      }\n\n      switch (event.key) {\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n\n          return focusIn(list, Focus.First)\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n\n          return focusIn(list, Focus.Last)\n      }\n\n      return match(orientation, {\n        vertical() {\n          if (event.key === Keys.ArrowUp) return focusIn(list, Focus.Previous | Focus.WrapAround)\n          if (event.key === Keys.ArrowDown) return focusIn(list, Focus.Next | Focus.WrapAround)\n          return\n        },\n        horizontal() {\n          if (event.key === Keys.ArrowLeft) return focusIn(list, Focus.Previous | Focus.WrapAround)\n          if (event.key === Keys.ArrowRight) return focusIn(list, Focus.Next | Focus.WrapAround)\n          return\n        },\n      })\n    },\n    [tabs, orientation, myIndex, change]\n  )\n\n  let handleFocus = useCallback(() => {\n    internalTabRef.current?.focus()\n  }, [internalTabRef])\n\n  let handleSelection = useCallback(() => {\n    internalTabRef.current?.focus()\n    change(myIndex)\n  }, [change, myIndex, internalTabRef])\n\n  let slot = useMemo(() => ({ selected }), [selected])\n  let propsWeControl = {\n    ref: tabRef,\n    onKeyDown: handleKeyDown,\n    onFocus: activation === 'manual' ? handleFocus : handleSelection,\n    onClick: handleSelection,\n    id,\n    role: 'tab',\n    type: useResolveButtonType(props, internalTabRef),\n    'aria-controls': panels[myIndex]?.current?.id,\n    'aria-selected': selected,\n    tabIndex: selected ? 0 : -1,\n  }\n  let passThroughProps = props\n\n  return render({\n    props: { ...passThroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_TAB_TAG,\n    name: 'Tabs.Tab',\n  })\n}\n\n// ---\n\nlet DEFAULT_PANELS_TAG = 'div' as const\ninterface PanelsRenderPropArg {\n  selectedIndex: number\n}\n\nfunction Panels<TTag extends ElementType = typeof DEFAULT_PANELS_TAG>(\n  props: Props<TTag, PanelsRenderPropArg>\n) {\n  let [{ selectedIndex }] = useTabsContext([Tab.name, Panels.name].join('.'))\n\n  let slot = useMemo(() => ({ selectedIndex }), [selectedIndex])\n\n  return render({\n    props,\n    slot,\n    defaultTag: DEFAULT_PANELS_TAG,\n    name: 'Tabs.Panels',\n  })\n}\n\n// ---\n\nlet DEFAULT_PANEL_TAG = 'div' as const\ninterface PanelRenderPropArg {\n  selected: boolean\n}\ntype PanelPropsWeControl = 'id' | 'role' | 'aria-labelledby' | 'tabIndex'\nlet PanelRenderFeatures = Features.RenderStrategy | Features.Static\n\nfunction Panel<TTag extends ElementType = typeof DEFAULT_PANEL_TAG>(\n  props: Props<TTag, PanelRenderPropArg, PanelPropsWeControl> &\n    PropsForFeatures<typeof PanelRenderFeatures>\n) {\n  let [{ selectedIndex, tabs, panels }, { dispatch }] = useTabsContext(\n    [Tab.name, Panel.name].join('.')\n  )\n\n  let id = `headlessui-tabs-panel-${useId()}`\n  let internalPanelRef = useRef<HTMLElement>(null)\n  let panelRef = useSyncRefs(internalPanelRef, element => {\n    if (!element) return\n    dispatch({ type: ActionTypes.ForceRerender })\n  })\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterPanel, panel: internalPanelRef })\n    return () => dispatch({ type: ActionTypes.UnregisterPanel, panel: internalPanelRef })\n  }, [dispatch, internalPanelRef])\n\n  let myIndex = panels.indexOf(internalPanelRef)\n  let selected = myIndex === selectedIndex\n\n  let slot = useMemo(() => ({ selected }), [selected])\n  let propsWeControl = {\n    ref: panelRef,\n    id,\n    role: 'tabpanel',\n    'aria-labelledby': tabs[myIndex]?.current?.id,\n    tabIndex: selected ? 0 : -1,\n  }\n\n  let passThroughProps = props\n\n  return render({\n    props: { ...passThroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_PANEL_TAG,\n    features: PanelRenderFeatures,\n    visible: selected,\n    name: 'Tabs.Panel',\n  })\n}\n\n// ---\n\nTab.Group = Tabs\nTab.List = List\nTab.Panels = Panels\nTab.Panel = Panel\n"],"names":["ActionTypes","reducers","SetSelectedIndex","state","action","selectedIndex","index","SetOrientation","orientation","SetActivation","activation","RegisterTab","tabs","includes","tab","UnregisterTab","filter","RegisterPanel","panels","panel","UnregisterPanel","ForceRerender","TabsContext","createContext","displayName","useTabsContext","component","context","useContext","err","Error","captureStackTrace","stateReducer","match","type","DEFAULT_TABS_TAG","Fragment","Tabs","props","defaultIndex","vertical","manual","onChange","passThroughProps","useReducer","dispatch","slot","useMemo","onChangeRef","useRef","useEffect","current","length","map","Boolean","focusableTabs","hasAttribute","indexToSet","indexOf","before","slice","after","next","find","lastChangedIndex","providerBag","change","React","Provider","value","render","defaultTag","name","DEFAULT_LIST_TAG","List","Tab","join","propsWeControl","role","DEFAULT_TAB_TAG","id","useId","internalTabRef","tabRef","useSyncRefs","element","useIsoMorphicEffect","myIndex","selected","handleKeyDown","useCallback","event","list","key","Keys","Space","Enter","preventDefault","stopPropagation","Home","PageUp","focusIn","Focus","First","End","PageDown","Last","ArrowUp","Previous","WrapAround","ArrowDown","Next","horizontal","ArrowLeft","ArrowRight","handleFocus","focus","handleSelection","ref","onKeyDown","onFocus","onClick","useResolveButtonType","tabIndex","DEFAULT_PANELS_TAG","Panels","DEFAULT_PANEL_TAG","PanelRenderFeatures","Features","RenderStrategy","Static","Panel","internalPanelRef","panelRef","features","visible","Group"],"mappings":"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"}